<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="law">
        <link rel="canonical" href="https://www.verynil.com/_posts/Drupal8-Content-Entity/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>"Drupal8 Content Entity" - 记录技术，分享知识，传播乐趣</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">记录技术，分享知识，传播乐趣</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../index.md" class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../about.md" class="nav-link">About</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Documents <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../chapters/usage.md" class="dropdown-item">Usage</a>
</li>
                                    
<li>
    <a href="../../chapters/tutorial.md" class="dropdown-item">Tutorial</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/captainQW/captainQW.github.io/edit/master/docs/_posts/Drupal8-Content-Entity.md" class="nav-link">Edit on verynil.github.io</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            
            
            
            
            
            
            
            
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<hr />
<p>这篇文章是<a href="http://verynull.com/2015/12/21/Drupal8-configuration-Entity/">Drupal8-configuration-Entity</a>的姊妹篇。主要介绍如何创建内容实体，并在界面上管理。</p>
<p>content entity最大的优势在于可自定义字段。</p>
<p>本文github：https://github.com/RamboLau/drupal8-demos/tree/master/content_entity_example</p>
<h3 id="_1">一、创建模块</h3>
<pre><code class="language-bash">mkdir content_entity_example

touch content_entity_example.info.yml
</code></pre>
<p>编辑内容为：</p>
<pre><code class="language-bash">name: content_entity_example
type: module
description: Provides ContentEntityExampleOnlineMessage entity.
core: 8.x
package: Other
</code></pre>
<h3 id="content_entity_exampleroutingyml">二、content_entity_example.routing.yml</h3>
<p>编辑内容为：</p>
<pre><code class="language-bash">
# OnlineMessage routing definition
entity.online_message.canonical:
  path: '/admin/structure/online_message/{online_message}'
  defaults:
    _entity_view: 'online_message'
    _title: 'Online message'
  requirements:
    _entity_access: 'online_message.view'
  options:
    _admin_route: TRUE

entity.online_message.collection:
  path: '/admin/structure/online_message'
  defaults:
    _entity_list: 'online_message'
    _title: 'Online message list'
  requirements:
    _permission: 'view online message entities'
  options:
    _admin_route: TRUE

entity.online_message.add_form:
  path: '/admin/structure/online_message/add'
  defaults:
    _entity_form: online_message.add
    _title: 'Add Online message'
  requirements:
    _permission: 'add online message entities'
  options:
    _admin_route: TRUE

entity.online_message.edit_form:
  path: '/admin/structure/online_message/{online_message}/edit'
  defaults:
    _entity_form: online_message.edit
    _title: 'Edit Online message'
  requirements:
    _permission: 'edit online message entities'
  options:
    _admin_route: TRUE

entity.online_message.delete_form:
  path: '/admin/structure/online_message/{online_message}/delete'
  defaults:
    _entity_form: online_message.delete
    _title: 'Delete Online message'
  requirements:
    _permission: 'delete online message entities'
  options:
    _admin_route: TRUE

online_message.settings:
  path: '/admin/structure/online_message/settings'
  defaults:
   _form: '\Drupal\content_entity_example\Form\OnlineMessageSettingsForm'
   _title: 'Online message settings'
  requirements:
    _permission: 'administer online message entities'
  options:
    _admin_route: TRUE

</code></pre>
<h3 id="content_entity_examplelinksmenuyml">三、content_entity_example.links.menu.yml</h3>
<p>编辑内容为：</p>
<pre><code class="language-bash"># Online message menu items definition
entity.online_message.collection:
  title: 'Online message list'
  route_name: entity.online_message.collection
  description: 'List Online message entities'
  parent: system.admin_structure
  weight: 100

online_message.admin.structure.settings:
  title: Online message settings
  description: 'Configure Online message entities'
  route_name: online_message.settings
  parent: system.admin_structure

</code></pre>
<p><img alt="menu" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223140428_47031.png" /></p>
<h3 id="content_entity_examplelinksactionyml">四、content_entity_example.links.action.yml</h3>
<p>编辑内容为：</p>
<pre><code class="language-bash">entity.online_message.add_form:
  route_name: entity.online_message.add_form
  title: 'Add Online message'
  appears_on:
    - entity.online_message.collection
    - entity.online_message.canonical

</code></pre>
<p><img alt="action" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223140610_19940.png" /></p>
<h3 id="content_entity_examplelinkstaskyml">五、content_entity_example.links.task.yml</h3>
<p>编辑内容为：</p>
<pre><code class="language-bash"># Online message routing definition
online_message.settings_tab:
  route_name: online_message.settings
  title: 'Settings'
  base_route: online_message.settings
entity.online_message.canonical:
  route_name: entity.online_message.canonical
  base_route: entity.online_message.canonical
  title: 'View'

entity.online_message.edit_form:
  route_name: entity.online_message.edit_form
  base_route: entity.online_message.canonical
  title: Edit

entity.online_message.delete_form:
  route_name:  entity.online_message.delete_form
  base_route:  entity.online_message.canonical
  title: Delete
  weight: 10

</code></pre>
<h3 id="entity">六、Entity类</h3>
<h4 id="1srconlinemessageinterfacephp">1、src/OnlineMessageInterface.php</h4>
<p>注：通过EntityOwnerInterface接口可获取其他的一些函数，如</p>
<p>编辑内容为：</p>
<pre><code class="language-php">&lt;?php

/**
 * @file
 * Contains \Drupal\content_entity_example\OnlineMessageInterface.
 */

namespace Drupal\content_entity_example;

use Drupal\Core\Entity\ContentEntityInterface;
use Drupal\Core\Entity\EntityChangedInterface;
use Drupal\Core\Entity\EntityTypeInterface;
use Drupal\user\EntityOwnerInterface;

/**
 * Provides an interface for defining Online message entities.
 *
 * @ingroup content_entity_example
 */
interface OnlineMessageInterface extends ContentEntityInterface, EntityChangedInterface, EntityOwnerInterface {
  // Add get/set methods for your configuration properties here.

  /**
   * Gets the Online message name.
   *
   * @return string
   *   Name of the Online message.
   */
  public function getName();

  /**
   * Sets the Online message name.
   *
   * @param string $name
   *   The Online message name.
   *
   * @return \Drupal\content_entity_example\OnlineMessageInterface
   *   The called Online message entity.
   */
  public function setName($name);

  /**
   * Gets the Online message creation timestamp.
   *
   * @return int
   *   Creation timestamp of the Online message.
   */
  public function getCreatedTime();

  /**
   * Sets the Online message creation timestamp.
   *
   * @param int $timestamp
   *   The Online message creation timestamp.
   *
   * @return \Drupal\content_entity_example\OnlineMessageInterface
   *   The called Online message entity.
   */
  public function setCreatedTime($timestamp);

  /**
   * Returns the Online message published status indicator.
   *
   * Unpublished Online message are only visible to restricted users.
   *
   * @return bool
   *   TRUE if the Online message is published.
   */
  public function isPublished();

  /**
   * Sets the published status of a Online message.
   *
   * @param bool $published
   *   TRUE to set this Online message to published, FALSE to set it to unpublished.
   *
   * @return \Drupal\content_entity_example\OnlineMessageInterface
   *   The called Online message entity.
   */
  public function setPublished($published);

}

?&gt;
</code></pre>
<h4 id="2srcentityonlinemessagephp">2、src/Entity/OnlineMessage.php</h4>
<p>编辑内容为：</p>
<pre><code class="language-php">&lt;?php

/**
 * @file
 * Contains \Drupal\content_entity_example\Entity\OnlineMessage.
 */

namespace Drupal\content_entity_example\Entity;

use Drupal\Core\Entity\EntityStorageInterface;
use Drupal\Core\Field\BaseFieldDefinition;
use Drupal\Core\Entity\ContentEntityBase;
use Drupal\Core\Entity\EntityChangedTrait;
use Drupal\Core\Entity\EntityTypeInterface;
use Drupal\content_entity_example\OnlineMessageInterface;
use Drupal\user\UserInterface;

/**
 * Defines the Online message entity.
 *
 * @ingroup content_entity_example
 *
 * @ContentEntityType(
 *   id = &quot;online_message&quot;,
 *   label = @Translation(&quot;Online message&quot;),
 *   handlers = {
 *     &quot;view_builder&quot; = &quot;Drupal\Core\Entity\EntityViewBuilder&quot;,
 *     &quot;list_builder&quot; = &quot;Drupal\content_entity_example\OnlineMessageListBuilder&quot;,
 *     &quot;views_data&quot; = &quot;Drupal\content_entity_example\Entity\OnlineMessageViewsData&quot;,
 *
 *     &quot;form&quot; = {
 *       &quot;default&quot; = &quot;Drupal\content_entity_example\Form\OnlineMessageForm&quot;,
 *       &quot;add&quot; = &quot;Drupal\content_entity_example\Form\OnlineMessageForm&quot;,
 *       &quot;edit&quot; = &quot;Drupal\content_entity_example\Form\OnlineMessageForm&quot;,
 *       &quot;delete&quot; = &quot;Drupal\content_entity_example\Form\OnlineMessageDeleteForm&quot;,
 *     },
 *     &quot;access&quot; = &quot;Drupal\content_entity_example\OnlineMessageAccessControlHandler&quot;,
 *   },
 *   base_table = &quot;online_message&quot;,
 *   admin_permission = &quot;administer OnlineMessage entities&quot;,
 *   entity_keys = {
 *     &quot;id&quot; = &quot;id&quot;,
 *     &quot;label&quot; = &quot;name&quot;,
 *     &quot;uuid&quot; = &quot;uuid&quot;,
 *     &quot;uid&quot; = &quot;user_id&quot;,
 *     &quot;langcode&quot; = &quot;langcode&quot;,
 *   },
 *   links = {
 *     &quot;canonical&quot; = &quot;/admin/online_message/{online_message}&quot;,
 *     &quot;edit-form&quot; = &quot;/admin/online_message/{online_message}/edit&quot;,
 *     &quot;delete-form&quot; = &quot;/admin/online_message/{online_message}/delete&quot;
 *   },
 *   field_ui_base_route = &quot;online_message.settings&quot;
 * )
 */
class OnlineMessage extends ContentEntityBase implements OnlineMessageInterface {
  use EntityChangedTrait;
  /**
   * {@inheritdoc}
   */
  public static function preCreate(EntityStorageInterface $storage_controller, array &amp;$values) {
    parent::preCreate($storage_controller, $values);
    $values += array(
      'user_id' =&gt; \Drupal::currentUser()-&gt;id(),
    );
  }

  /**
   * {@inheritdoc}
   */
  public function getName() {
    return $this-&gt;get('name')-&gt;value;
  }

  /**
   * {@inheritdoc}
   */
  public function setName($name) {
    $this-&gt;set('name', $name);
    return $this;
  }

  /**
   * {@inheritdoc}
   */
  public function getCreatedTime() {
    return $this-&gt;get('created')-&gt;value;
  }

  /**
   * {@inheritdoc}
   */
  public function setCreatedTime($timestamp) {
    $this-&gt;set('created', $timestamp);
    return $this;
  }

  /**
   * {@inheritdoc}
   */
  public function getOwner() {
    return $this-&gt;get('user_id')-&gt;entity;
  }

  /**
   * {@inheritdoc}
   */
  public function getOwnerId() {
    return $this-&gt;get('user_id')-&gt;target_id;
  }

  /**
   * {@inheritdoc}
   */
  public function setOwnerId($uid) {
    $this-&gt;set('user_id', $uid);
    return $this;
  }

  /**
   * {@inheritdoc}
   */
  public function setOwner(UserInterface $account) {
    $this-&gt;set('user_id', $account-&gt;id());
    return $this;
  }

  /**
   * {@inheritdoc}
   */
  public function isPublished() {
    return (bool) $this-&gt;getEntityKey('status');
  }

  /**
   * {@inheritdoc}
   */
  public function setPublished($published) {
    $this-&gt;set('status', $published ? NODE_PUBLISHED : NODE_NOT_PUBLISHED);
    return $this;
  }

  /**
   * {@inheritdoc}
   */
  public static function baseFieldDefinitions(EntityTypeInterface $entity_type) {
    $fields['id'] = BaseFieldDefinition::create('integer')
      -&gt;setLabel(t('ID'))
      -&gt;setDescription(t('The ID of the Online message entity.'))
      -&gt;setReadOnly(TRUE);
    $fields['uuid'] = BaseFieldDefinition::create('uuid')
      -&gt;setLabel(t('UUID'))
      -&gt;setDescription(t('The UUID of the Online message entity.'))
      -&gt;setReadOnly(TRUE);

    $fields['user_id'] = BaseFieldDefinition::create('entity_reference')
      -&gt;setLabel(t('Authored by'))
      -&gt;setDescription(t('The user ID of author of the Online message entity.'))
      -&gt;setRevisionable(TRUE)
      -&gt;setSetting('target_type', 'user')
      -&gt;setSetting('handler', 'default')
      -&gt;setDefaultValueCallback('Drupal\node\Entity\Node::getCurrentUserId')
      -&gt;setTranslatable(TRUE)
      -&gt;setDisplayOptions('view', array(
        'label' =&gt; 'hidden',
        'type' =&gt; 'author',
        'weight' =&gt; 0,
      ))
      -&gt;setDisplayOptions('form', array(
        'type' =&gt; 'entity_reference_autocomplete',
        'weight' =&gt; 5,
        'settings' =&gt; array(
          'match_operator' =&gt; 'CONTAINS',
          'size' =&gt; '60',
          'autocomplete_type' =&gt; 'tags',
          'placeholder' =&gt; '',
        ),
      ))
      -&gt;setDisplayConfigurable('form', TRUE)
      -&gt;setDisplayConfigurable('view', TRUE);

    $fields['name'] = BaseFieldDefinition::create('string')
      -&gt;setLabel(t('Name'))
      -&gt;setDescription(t('The name of the Online message entity.'))
      -&gt;setSettings(array(
        'max_length' =&gt; 50,
        'text_processing' =&gt; 0,
      ))
      -&gt;setDefaultValue('')
      -&gt;setDisplayOptions('view', array(
        'label' =&gt; 'above',
        'type' =&gt; 'string',
        'weight' =&gt; -4,
      ))
      -&gt;setDisplayOptions('form', array(
        'type' =&gt; 'string_textfield',
        'weight' =&gt; -4,
      ))
      -&gt;setDisplayConfigurable('form', TRUE)
      -&gt;setDisplayConfigurable('view', TRUE);

    $fields['status'] = BaseFieldDefinition::create('boolean')
      -&gt;setLabel(t('Publishing status'))
      -&gt;setDescription(t('A boolean indicating whether the Online message is published.'))
      -&gt;setDefaultValue(TRUE);

    $fields['langcode'] = BaseFieldDefinition::create('language')
      -&gt;setLabel(t('Language code'))
      -&gt;setDescription(t('The language code for the Online message entity.'));

    $fields['created'] = BaseFieldDefinition::create('created')
      -&gt;setLabel(t('Created'))
      -&gt;setDescription(t('The time that the entity was created.'));

    $fields['changed'] = BaseFieldDefinition::create('changed')
      -&gt;setLabel(t('Changed'))
      -&gt;setDescription(t('The time that the entity was last edited.'));

    return $fields;
  }

}
?&gt;
</code></pre>
<p>注解的相关名词解释：</p>
<p>1、id：实体类型唯一标识符，一般遵循'modulename_xyz'的命名规则。</p>
<p>2、label：易读的实体名称。</p>
<p>3、handlers：不同的任务所使用的处理程序，一般来说，标准的处理方法有：
    1)、view_builder：由routing.yml中的'_entity_view'所调用。</p>
<pre><code>2)、list_builder：继承entityListBuilder，展示在线留言的列表。

3)、form：由routing.yml中的'_entity_form'所调用。

4)、access：设定访问权限
</code></pre>
<p>4、base_table：定义存储数据的表，必须唯一哦！schema由BaseFieldDefinitions决定，该表会在模块启用的时候自动创建。</p>
<p>5、fieldable：可以添加自定义字段，只有内容实体才有这个功能</p>
<p>6、entity_keys：访问fields的字段，如nid或uid</p>
<p>7、links：操作链接，如'edit-form'和'delete-form'。在列表页可以看到相应的操作按钮。</p>
<h3 id="_2">七、控制器类</h3>
<h4 id="1srcformonlinemessageformphp">1、src/Form/OnlineMessageForm.php</h4>
<p>由routing中定义的'_entity_form'调用。</p>
<p>编辑内容为：</p>
<pre><code class="language-php">&lt;?php

/**
 * @file
 * Contains \Drupal\content_entity_example\Form\OnlineMessageForm.
 */

namespace Drupal\content_entity_example\Form;

use Drupal\Core\Entity\ContentEntityForm;
use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Language\Language;

/**
 * Form controller for Online message edit forms.
 *
 * @ingroup content_entity_example
 */
class OnlineMessageForm extends ContentEntityForm {
  /**
   * {@inheritdoc}
   */
  public function buildForm(array $form, FormStateInterface $form_state) {
    /* @var $entity \Drupal\content_entity_example\Entity\OnlineMessage */
    $form = parent::buildForm($form, $form_state);
    $entity = $this-&gt;entity;

    $form['langcode'] = array(
      '#title' =&gt; $this-&gt;t('Language'),
      '#type' =&gt; 'language_select',
      '#default_value' =&gt; $entity-&gt;langcode-&gt;value,
      '#languages' =&gt; Language::STATE_ALL,
    );

    return $form;
  }

  /**
   * {@inheritdoc}
   */
  public function submit(array $form, FormStateInterface $form_state) {
    // Build the entity object from the submitted values.
    $entity = parent::submit($form, $form_state);

    return $entity;
  }

  /**
   * {@inheritdoc}
   */
  public function save(array $form, FormStateInterface $form_state) {
    $entity = $this-&gt;entity;
    $status = $entity-&gt;save();

    switch ($status) {
      case SAVED_NEW:
        drupal_set_message($this-&gt;t('Created the %label Online message.', [
          '%label' =&gt; $entity-&gt;label(),
        ]));
        break;

      default:
        drupal_set_message($this-&gt;t('Saved the %label Online message.', [
          '%label' =&gt; $entity-&gt;label(),
        ]));
    }
    $form_state-&gt;setRedirect('entity.online_message.edit_form', ['online_message' =&gt; $entity-&gt;id()]);
  }

}

?&gt;
</code></pre>
<p><img alt="add_form" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223143411_52761.png" /></p>
<h4 id="2srcformonlinemessagedeleteformphp">2、src/Form/OnlineMessageDeleteForm.php</h4>
<p>编辑内容为：</p>
<pre><code class="language-php">&lt;?php

/**
 * @file
 * Contains \Drupal\content_entity_example\Form\OnlineMessageDeleteForm.
 */

namespace Drupal\content_entity_example\Form;

use Drupal\Core\Entity\ContentEntityConfirmFormBase;
use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Url;

/**
 * Provides a form for deleting Online message entities.
 *
 * @ingroup content_entity_example
 */
class OnlineMessageDeleteForm extends ContentEntityConfirmFormBase {
  /**
   * {@inheritdoc}
   */
  public function getQuestion() {
    return $this-&gt;t('Are you sure you want to delete entity %name?', array('%name' =&gt; $this-&gt;entity-&gt;label()));
  }

  /**
   * {@inheritdoc}
   */
  public function getCancelUrl() {
    return new Url('entity.online_message.collection');
  }

  /**
   * {@inheritdoc}
   */
  public function getConfirmText() {
    return $this-&gt;t('Delete');
  }

  /**
   * {@inheritdoc}
   */
  public function submitForm(array &amp;$form, FormStateInterface $form_state) {
    $this-&gt;entity-&gt;delete();

    drupal_set_message(
      $this-&gt;t('content @type: deleted @label.',
        [
          '@type' =&gt; $this-&gt;entity-&gt;bundle(),
          '@label' =&gt; $this-&gt;entity-&gt;label()
        ]
        )
    );

    $form_state-&gt;setRedirectUrl($this-&gt;getCancelUrl());
  }

}

?&gt;
</code></pre>
<p><img alt="delete_form" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223143307_47107.png" /></p>
<h4 id="3srconlinemessagelistbuilderphp">3、src/OnlineMessageListBuilder.php</h4>
<p>编辑内容为：</p>
<pre><code class="language-php">&lt;?php

/**
 * @file
 * Contains \Drupal\content_entity_example\OnlineMessageListBuilder.
 */

namespace Drupal\content_entity_example;

use Drupal\Core\Entity\EntityInterface;
use Drupal\Core\Entity\EntityListBuilder;
use Drupal\Core\Routing\LinkGeneratorTrait;
use Drupal\Core\Url;

/**
 * Defines a class to build a listing of Online message entities.
 *
 * @ingroup content_entity_example
 */
class OnlineMessageListBuilder extends EntityListBuilder {
  use LinkGeneratorTrait;
  /**
   * {@inheritdoc}
   */
  public function buildHeader() {
    $header['id'] = $this-&gt;t('Online message ID');
    $header['name'] = $this-&gt;t('Name');
    return $header + parent::buildHeader();
  }

  /**
   * {@inheritdoc}
   */
  public function buildRow(EntityInterface $entity) {
    /* @var $entity \Drupal\content_entity_example\Entity\OnlineMessage */
    $row['id'] = $entity-&gt;id();
    $row['name'] = $this-&gt;l(
      $entity-&gt;label(),
      new Url(
        'entity.online_message.edit_form', array(
          'online_message' =&gt; $entity-&gt;id(),
        )
      )
    );
    return $row + parent::buildRow($entity);
  }

}

?&gt;
</code></pre>
<p><img alt="list_builder" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223143200_33896.png" /></p>
<h3 id="field">八、Field配置</h3>
<h4 id="1srcformonlinemessagesettingsformphp">1、src/Form/OnlineMessageSettingsForm.php</h4>
<p>编辑内容为：</p>
<pre><code class="language-php">&lt;?php

/**
 * @file
 * Contains \Drupal\content_entity_example\Form\OnlineMessageSettingsForm.
 */

namespace Drupal\content_entity_example\Form;

use Drupal\Core\Form\FormBase;
use Drupal\Core\Form\FormStateInterface;

/**
 * Class OnlineMessageSettingsForm.
 *
 * @package Drupal\content_entity_example\Form
 *
 * @ingroup content_entity_example
 */
class OnlineMessageSettingsForm extends FormBase {
  /**
   * Returns a unique string identifying the form.
   *
   * @return string
   *   The unique string identifying the form.
   */
  public function getFormId() {
    return 'OnlineMessage_settings';
  }

  /**
   * Form submission handler.
   *
   * @param array $form
   *   An associative array containing the structure of the form.
   * @param \Drupal\Core\Form\FormStateInterface $form_state
   *   The current state of the form.
   */
  public function submitForm(array &amp;$form, FormStateInterface $form_state) {
    // Empty implementation of the abstract submit class.
  }


  /**
   * Defines the settings form for Online message entities.
   *
   * @param array $form
   *   An associative array containing the structure of the form.
   * @param \Drupal\Core\Form\FormStateInterface $form_state
   *   The current state of the form.
   *
   * @return array
   *   Form definition array.
   */
  public function buildForm(array $form, FormStateInterface $form_state) {
    $form['OnlineMessage_settings']['#markup'] = 'Settings form for Online message entities. Manage field settings here.';
    return $form;
  }

}

?&gt;
</code></pre>
<p><img alt="设置" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223142648_96014.png" /></p>
<p><img alt="管理字段" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223142758_83626.png" /></p>
<p><img alt="管理表单显示" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223142828_19080.png" /></p>
<p><img alt="管理显示" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223142848_49971.png" /></p>
<h3 id="entity_1">九、注册entity</h3>
<p>启用模块，会自动根据Entity中的配置创建online_message表。</p>
<p><img alt="online_message_table" src="https://static.verycloud.cn/sites/default/files/pic/image/20151223/20151223140008_92664.png" /></p>
<p>参考文章：
1、https://www.drupal.org/node/2192175
2、http://www.slideshare.net/andypost/d8-entity</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
