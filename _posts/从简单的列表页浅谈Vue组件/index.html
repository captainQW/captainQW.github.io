<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="law">
        <link rel="canonical" href="https://www.verynil.com/_posts/%E4%BB%8E%E7%AE%80%E5%8D%95%E7%9A%84%E5%88%97%E8%A1%A8%E9%A1%B5%E6%B5%85%E8%B0%88Vue%E7%BB%84%E4%BB%B6/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>"从简单的列表页浅谈Vue组件" - 记录技术，分享知识，传播乐趣</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="../..">记录技术，分享知识，传播乐趣</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../index.md" class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../about.md" class="nav-link">About</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Documents <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../chapters/usage.md" class="dropdown-item">Usage</a>
</li>
                                    
<li>
    <a href="../../chapters/tutorial.md" class="dropdown-item">Tutorial</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/captainQW/captainQW.github.io/edit/master/docs/_posts/从简单的列表页浅谈Vue组件.md" class="nav-link">Edit on verynil.github.io</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#_1" class="nav-link">组件</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">例子</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#_3" class="nav-link">几个点：</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#_8" class="nav-link">引申问题：</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<hr />
<h2 id="_1">组件</h2>
<p>什么是组件？</p>
<p>组件（Component）是 Vue.js 最强大的功能之一。组件可以扩展 HTML 元素，封装可重用的代码。在较高层面上，组件是自定义元素， Vue.js 的编译器为它添加特殊功能。在有些情况下，组件也可以是原生 HTML 元素的形式，以 js 特性扩展。</p>
<h2 id="_2">例子</h2>
<p><img alt="" src="screen.png" /></p>
<p>举个小例子：豆瓣电影排行榜</p>
<p>此例子包含文章列表，分页，这里把列表和分页分别当作单独的组件，加上父页面组件一共是3个</p>
<p>父组件：<code>app.vue</code></p>
<p>子组件：<code>list.vue</code> <code>pagination.vue</code></p>
<p>接口用的是豆瓣的jsonp，<code>https://api.douban.com/v2/movie/top250</code></p>
<p>首先在main.js引入父组件，引入less，引入VueResource，实例化vue</p>
<pre><code class="language-js">//main.js

import Vue from 'vue'
import app from './example1/app.vue'
import './example1/style.less'

import VueResource from 'vue-resource'
Vue.use(VueResource)

new Vue({
  render: h =&gt; h(app)
}).$mount('#app')

</code></pre>
<p>从分页开始，在src/example1/components文件夹下建立一个pagination.vue文件</p>
<pre><code class="language-html">&lt;!--pagination.vue--&gt;
&lt;template&gt;
  &lt;div class=&quot;text-center&quot;&gt;
    &lt;ul class=&quot;pagination&quot;&gt;
      &lt;li&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;

&lt;/template&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
export default {
  data () {
    return {
    }
  },
  props: {
  },
  methods: {
  },
  computed: {
  },
  components: {
  },
  mounted () {
  }
}
&lt;/script&gt;
</code></pre>
<p>通过props从父组件接收数据。组件可以为props指定验证要求。如果未指定验证要求，Vue会发出警告，如果不需要验证，可以用数组形式</p>
<pre><code class="language-js">//pagination.vue

props: {
    //当前页码
    now: {
      type: Number,
      default: 1
    },
    //总页数
    all: {
      type: Number,
      default: 1,
      required: 1
    }
  }
</code></pre>
<p>父组件app.vue引入组件，并且把数据传给子组件</p>
<pre><code class="language-html">&lt;!--app.vue--&gt;

&lt;!--代码片段--&gt;
&lt;pagination :now=&quot;page.now&quot; :all=&quot;page.all&quot;&gt;&lt;/pagination&gt;
&lt;!--代码片段--&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

import pagination from './components/pagination.vue'
export default {
  data () {
    return {
        page: {
            now: 1,
            all: 10
        }

    }
  },
  components: {
    pagination
  }
}
&lt;/script&gt;
</code></pre>
<p>根据传入的数据计算分页数据</p>
<pre><code class="language-js">//pagination.vue

computed: {
    pages () {
      var pages = [];
      if(this.now &gt; 1) pages.push({
        text: '上一页',
        num: this.now - 1
      });
      if(this.now - 1 &gt; 2) pages.push({
        text: 1,
        num: 1
      });
      if(this.now - 1 &gt; 3) pages.push({
        text: '...',
        num: 0
      });
      for (var i = 1; i &lt;= this.all; i++) {
        if(this.now - i &lt; 3 &amp;&amp; this.now &gt;= i || i - this.now &lt; 3 &amp;&amp; this.now &lt;= i){
          pages.push({
            text: i,
            num: i
          });          
        }        
      }
      if(this.all - this.now &gt; 3) pages.push({
        text: '...',
        num: 0
      });
      if(this.all - this.now &gt; 2) pages.push({
        text: this.all,
        num: this.all
      });
      if(this.now &lt; this.all) pages.push({
        text: '下一页',
        num: this.now + 1
      });

      return pages;
    }

  }
</code></pre>
<p>用v-for把分页渲染出来</p>
<pre><code class="language-html">&lt;!--pagination.vue--&gt;

&lt;template&gt;
  &lt;ul class=&quot;pagination&quot;&gt;
    &lt;li v-for=&quot;page in pages&quot; :class=&quot;{ 'active' : page.num == now }&quot;&gt;
        &lt;a v-if=&quot;page.num&quot; @click=&quot;toPage(page.num)&quot;&gt;{{ page.text }}&lt;/a&gt;
        &lt;span v-else&gt;{{ page.text }}&lt;/span&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/template&gt;
</code></pre>
<p>子组件通过自定义事件向父组件传事件和数据</p>
<pre><code class="language-js">//pagination.vue

methods: {
    toPage (page) {
      this.$emit('toPage', page);

    }

  }
</code></pre>
<p>父组件监听这个事件，然后调用方法changePage</p>
<pre><code class="language-html">&lt;!--app.vue--&gt;

&lt;pagination :now=&quot;page.now&quot; :all=&quot;page.all&quot; @toPage=&quot;changePage&quot;&gt;&lt;/pagination&gt;

&lt;script&gt;
//代码片段
methods: {
    changePage (page) {
      this.page.now = page
    } 

}
//代码片段
&lt;/script&gt;
</code></pre>
<p>至此完成了父组件把数据丢给子组件处理，子组件把操作反馈给父组件这一过程</p>
<p>列表组件list.vue</p>
<pre><code class="language-html">&lt;!--list.vue--&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;slot name=&quot;title&quot;&gt;&lt;/slot&gt;
    &lt;div class=&quot;list clearfix row&quot;&gt;
      &lt;div class=&quot;col-xs-6&quot; v-for=&quot;item in items&quot;&gt;
        &lt;div class=&quot;item&quot;&gt;
          &lt;div class=&quot;img&quot;&gt;
            &lt;img :src=&quot;item.images.small&quot;&gt;&lt;/div&gt;
          &lt;slot name=&quot;year&quot; :year=&quot;item.year&quot;&gt;
            &lt;div class=&quot;year&quot;&gt;{{ item.year }}&lt;/div&gt;
          &lt;/slot&gt;
          &lt;div class=&quot;title&quot;&gt;{{ item.title }}&lt;/div&gt;
          &lt;div class=&quot;dis&quot;&gt;{{ item.original_title }}&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
export default {
  data () {
    return {

    }
  },
  props: ['items']
}
&lt;/script&gt;
</code></pre>
<p>来点动态的数据</p>
<pre><code class="language-html">&lt;!--app.vue--&gt;

&lt;template&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;loading&quot; v-show=&quot;loading&quot;&gt;&lt;/div&gt;

    &lt;list :items=&quot;items&quot;&gt;
      &lt;h1 class=&quot;text-center&quot; slot=&quot;title&quot;&gt;豆瓣电影排行榜&lt;/h1&gt;
      &lt;template slot=&quot;year&quot; scope=&quot;props&quot;&gt;
        &lt;div class=&quot;year red&quot;&gt;{{ props.year }}&lt;/div&gt;
      &lt;/template&gt;
    &lt;/list&gt;
    &lt;pagination :now=&quot;page.now&quot; :all=&quot;page.all&quot; @toPage=&quot;changePage&quot;&gt;&lt;/pagination&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
import list from './components/list.vue'
import pagination from './components/pagination.vue'
export default {
  data () {
    return {
      loading: 0,
      params: {
        //每页显示条数
        count: 10,
        //从第几条开始显示，初始0
        start: 0,
        //总条数
        total: 250
      },      
      items: []      
    }
  },
  methods: {
    getItems () {
      this.loading = 1;
      this.$http.jsonp('https://api.douban.com/v2/movie/top250', {
        params: this.params
      }).then(response =&gt; {
        if(response.ok) {
          this.items = response.data.subjects;
          this.params = {
            count: response.data.count,
            start: response.data.start,
            total: response.data.total
          }
        }

      }, response =&gt; {
        console.log(response);

      }).finally(function(){
        this.loading = 0;
      })

    },
    changePage (page) {
      this.params.start = (page - 1) * this.params.count;
      this.getItems();
    } 

  },
  components: {
    list,
    pagination
  },
  computed: {
    page () {
      return {
        now: this.params.start / this.params.count + 1,
        all: Math.ceil(this.params.total / this.params.count)
      }      
    }

  },
  mounted () {
    this.getItems();
  }
}
&lt;/script&gt;
</code></pre>
<h2 id="_3">几个点：</h2>
<h3 id="prop">prop传递数据</h3>
<blockquote>
<p>组件实例的作用域是孤立的。这意味着不能并且不应该在子组件的模板内直接引用父组件的数据。可以使用 props 把数据传给子组件。</p>
<p>类似于用 v-bind 绑定 HTML 特性到一个表达式，也可以用 v-bind 动态绑定 props 的值到父组件的数据中。每当父组件的数据变化时，该变化也会传导给子组件：</p>
</blockquote>
<h3 id="_4">自定义事件</h3>
<blockquote>
<p>父组件可以在使用子组件的地方直接用 v-on 来监听子组件触发的事件</p>
</blockquote>
<h3 id="slot">slot分发内容</h3>
<blockquote>
<p>组件不知道它的挂载点会有什么内容。挂载点的内容是~~由父组件决~~定的;组件很可能有它自己的模版</p>
<p>为了让组件可以组合，我们需要一种方式来混合父组件的内容与子组件自己的模板。这个过程被称为 内容分发 (或 “transclusion” 如果你熟悉 Angular)。Vue.js 实现了一个内容分发 API ，参照了当前 Web 组件规范草案，使用特殊的 <code>&lt;slot&gt;</code> 元素作为原始内容的插槽。</p>
</blockquote>
<p><code>通过slot插槽将标题插入到子组件</code></p>
<h3 id="_5">作用域插槽</h3>
<blockquote>
<p>父组件模板的内容在父组件作用域内编译；子组件模板的内容在子组件作用域内编译</p>
<p>作用域插槽是一种特殊类型的插槽，用作使用一个（能够传递数据到）可重用模板替换已渲染元素。
在子组件中，只需将数据传递到插槽，就像你将 prop 传递给组件一样</p>
</blockquote>
<p><code>通过作用域插槽将子组件数据传给父组件，再作为自定义模板重新插入到子组件</code></p>
<h3 id="_6">计算</h3>
<p><code>豆瓣接口接收参数和设计的不同，pages需要通过computed计算</code></p>
<h3 id="_7">分页的算法</h3>
<h2 id="_8">引申问题：</h2>
<p>watch params变化</p>
<p>loading广播</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
